<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ES2 Workshop Gallery</title>
    <link rel="icon" type="image/png" href="https://pinestudio.com/wp-content/uploads/2024/12/es2_store_capsule_vertical.png">
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
    <style>
        :root { 
            --bg-dark: #0b0e14; 
            --header-bg: #11161f;
            --text-main: #e0e6ed; 
            --card-bg: #1a222d; 
            --accent-gold: #f4c054; 
            --accent-blue: #66c0f4; 
            --border: rgba(255, 255, 255, 0.08);
            --danger: #ff4d4d;
        }

        body { 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            background: var(--bg-dark); 
            color: var(--text-main); 
            margin: 0; 
            overflow-y: scroll;
        }

        .lang-dock { position: absolute; top: 15px; right: 25px; z-index: 1100; }
        #langSelect { background: #242e3a; color: var(--accent-gold); border: 1px solid var(--accent-gold); padding: 5px 10px; font-weight: bold; border-radius: 4px; cursor: pointer; }
        .page-banner { text-align: center; padding: 20px; background: linear-gradient(to bottom, #1a222d, #0b0e14); border-bottom: 1px solid var(--border); }
        header { position: sticky; top: 0; background: var(--header-bg); padding: 1.2rem; display: flex; flex-wrap: wrap; gap: 15px; z-index: 1000; box-shadow: 0 8px 32px rgba(0,0,0,0.6); align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); }
        #search { flex: 2; min-width: 180px; }
        input, select { padding: 10px; border-radius: 6px; border: 1px solid var(--border); background: #242e3a; color: white; outline: none; }
        .btn { padding: 8px 14px; border-radius: 6px; border: none; cursor: pointer; font-weight: 600; font-size: 0.8rem; transition: 0.2s; display: flex; align-items: center; gap: 6px; }
        .btn-gold { background: var(--accent-gold); color: #000; }
        .btn-gold:disabled { background: #444; color: #888; cursor: not-allowed; }
        .btn-outline { background: transparent; color: var(--accent-gold); border: 1px solid var(--accent-gold); }
        .counter-container { display: flex; align-items: center; gap: 10px; background: rgba(244, 192, 84, 0.1); padding: 6px 14px; border-radius: 20px; }
        .counter { font-size: 0.9rem; font-weight: 600; color: var(--accent-gold); }
        .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 24px; padding: 24px; min-height: 100vh; }
        .card { background: var(--card-bg); border-radius: 10px; overflow: hidden; display: flex; flex-direction: column; border: 1px solid var(--border); transition: 0.4s; opacity: 0; transform: translateY(15px); position: relative; }
        .card.ready { opacity: 1; transform: translateY(0); }
        .card-checkbox { position: absolute; top: 12px; left: 12px; width: 22px; height: 22px; z-index: 5; cursor: pointer; accent-color: var(--accent-gold); }
        .card img { width: 100%; aspect-ratio: 16/9; object-fit: cover; background: #000; opacity: 0; transition: 0.5s; }
        .card img.loaded { opacity: 1; }
        .card-info { padding: 18px; flex-grow: 1; display: flex; flex-direction: column; }
        .card-title { font-weight: 700; font-size: 1.05rem; margin-bottom: 10px; color: var(--accent-blue); height: 2.8em; overflow: hidden; }
        .card-footer { margin-top: auto; padding-top: 15px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .dl-single { color: var(--accent-gold); text-decoration: none; font-size: 0.8rem; font-weight: bold; }
    </style>
</head>
<body>

<div class="lang-dock">
    <select id="langSelect">
        <option value="en">üá∫üá∏ English</option>
        <option value="uk">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
        <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
    </select>
</div>

<div class="page-banner">
    <h1>ESCAPE SIMULATOR 2 WORKSHOP</h1>
</div>

<header>
    <input type="text" id="search" placeholder="...">
    <div class="counter-container"><span class="counter" id="itemCounter">...</span></div>
    <div class="header-section">
        <button class="btn btn-outline" id="btnSelectAll"></button>
        <button class="btn btn-gold" id="btnDownloadSelected" disabled>
            <span id="txtDownload"></span> (<span id="selectedCount">0</span>)
        </button>
    </div>
</header>

<div class="gallery" id="gallery"></div>

<script>
    // CHANGED: Now using local worker path 
    const DATA_URL = '/workshopcontent.json';
    const IMAGE_BASE = '/images/'; 

    const TRANSLATIONS = {
        en: { search: "Search Items...", selectAll: "Select All", download: "Download", maps: "Maps", id: "ID", updated: "Updated", dl: "‚¨á DOWNLOAD" },
        uk: { search: "–ü–æ—à—É–∫...", selectAll: "–í–∏–±—Ä–∞—Ç–∏ –≤—Å–µ", download: "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏", maps: "–ú–∞–ø", id: "ID", updated: "–û–Ω–æ–≤–ª–µ–Ω–æ", dl: "‚¨á –ó–ê–í–ê–ù–¢–ê–ñ–ò–¢–ò" },
        ru: { search: "–ü–æ–∏—Å–∫...", selectAll: "–í—ã–±—Ä–∞—Ç—å –≤—Å–µ", download: "–°–∫–∞—á–∞—Ç—å", maps: "–ö–∞—Ä—Ç", id: "ID", updated: "–û–±–Ω–æ–≤–ª–µ–Ω–æ", dl: "‚¨á –°–ö–ê–ß–ê–¢–¨" }
    };

    let allData = [], selectedUrls = new Set(), currentLang = localStorage.getItem('es2_lang') || 'en';

    function t(key) { return TRANSLATIONS[currentLang][key] || TRANSLATIONS['en'][key]; }

    function applyUILanguage() {
        document.getElementById('search').placeholder = t('search');
        document.getElementById('btnSelectAll').innerText = t('selectAll');
        document.getElementById('txtDownload').innerText = t('download');
    }

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                img.src = img.dataset.src;
                img.onload = () => { img.classList.add('loaded'); img.closest('.card').classList.add('ready'); };
                observer.unobserve(img);
            }
        });
    }, { rootMargin: '400px' });

    async function init() {
        applyUILanguage();
        try {
            const res = await fetch(DATA_URL); // Fetches through Worker 
            allData = await res.json();
            render(allData);
        } catch (e) { console.error("Data load failed", e); }
    }

    function render(data) {
        const gallery = document.getElementById('gallery');
        gallery.innerHTML = data.map(item => {
            // CHANGED: Images now requested from /images/{id}.jpg 
            const localImgUrl = `${IMAGE_BASE}${item.id}.jpg`;
            return `
                <div class="card" data-download-url="${item.downloadUrl}">
                    <input type="checkbox" class="card-checkbox">
                    <img data-src="${localImgUrl}" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" class="lazy-img">
                    <div class="card-info">
                        <div class="card-title">${item.name}</div>
                        <div class="card-meta"><b>${t('id')}:</b> ${item.id}</div>
                        <div class="card-footer"><a href="${item.downloadUrl}" class="dl-single">${t('dl')}</a></div>
                    </div>
                </div>`;
        }).join('');
        document.querySelectorAll('.lazy-img').forEach(img => observer.observe(img));
        document.querySelectorAll('.card-checkbox').forEach(cb => cb.addEventListener('change', (e) => toggleSelection(e.target.closest('.card'), e.target.checked)));
        document.getElementById('itemCounter').innerText = `${data.length} ${t('maps')}`;
    }

    function toggleSelection(card, isSelected) {
        const url = card.dataset.downloadUrl;
        isSelected ? (card.classList.add('selected'), selectedUrls.add(url)) : (card.classList.remove('selected'), selectedUrls.delete(url));
        document.getElementById('selectedCount').innerText = selectedUrls.size;
        document.getElementById('btnDownloadSelected').disabled = selectedUrls.size === 0;
    }

    init();
</script>
</body>
</html>
